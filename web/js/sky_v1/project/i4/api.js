window.api||(window.api={}),api.data||(api.data={}),api.config||(api.config={}),window.console||(window.console={log:function(){}}),String.Config={uniRe:"**",uniExp:/[*]{2}/g,uniRemove:/[*]/g},String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s\s*$/,"")},String.prototype.htmlEncode=function(t){return(t?this.uniLeft(30,".."):this).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&#34;").replace(/\'/g,"&#39;")},String.prototype.htmlEncodeBr=function(t){return this.htmlEncode(t).replace(/\n/g,"<br />")},Date.prototype.format=function(t){return(t||"YYYY-MM-DD").replace(/YYYY/g,this.getFullYear()).replace(/YY/g,String(this.getYear()).slice(-2)).replace(/MM/g,("0"+(this.getMonth()+1)).slice(-2)).replace(/M/g,this.getMonth()+1).replace(/DD/g,("0"+this.getDate()).slice(-2)).replace(/D/g,this.getDate()).replace(/hh/g,("0"+this.getHours()).slice(-2)).replace(/h/g,this.getHours()).replace(/mm/g,("0"+this.getMinutes()).slice(-2)).replace(/m/g,this.getMinutes()).replace(/ss/g,("0"+this.getSeconds()).slice(-2)).replace(/s/g,this.getSeconds())},void function(t){function e(){var e=document.getElementById("__loading_");if(!e)if("none"!=i.getData("load")){e=document.createElement("div"),e.id="__loading_",e.style.cssText=" position: fixed; width: 100%; text-align: center; padding: 2px 0;top:0; height: 100%; background-color: rgba(0, 0, 0, 0.1); z-index: 9999; display:none;",e.innerHTML='<img style="margin-top:300px;" src="/admin/res/img/loading.gif" />',document.body.appendChild(e);var n=0;t.openLoad=function(){n+=1,1==n&&(e.style.display="block")},t.closeLoad=function(){n-=1,0==n&&(e.style.display="none"),n=Math.max(n,0)}}else t.openLoad=t.closeLoad=function(){}}function n(t){return new RegExp("[?:; ]*"+t+"=([^;]*);?").test(document.cookie+"")?decodeURIComponent(RegExp.$1):""}function o(){e(),t.onload&&t.onload();var o=i.getData("verify");if(t.data.user_id=n("AGENTID"),t.data.user_nick=n("AUTHNAME"),t.data.user_img=n("AUTHIMG"),"must"==o&&""==t.data.user_id)return void t.login();var a=document.getElementById("_api_nickname_");a&&(a.innerHTML=t.data.user_nick.htmlEncode());var r=document.getElementById("_api_pwd_exit_");r&&(r.onclick=function(){t.logout()});var c=document.getElementById("_api_pwd_edit_");c&&(c.onclick=function(){document.location.href="pwd.html"});var s=i.getData("js");if("none"!=s){var l=i.getPageJS(),u=i.getData("version")||"";u&&(l=l+"?"+u),l=s?/,$/.test(s)?s+l:s:l;var s=l?l.split(","):[];return void(s.length&&sky.use.apply(sky,s))}}var i=t.config;i.version.sky&&(sky.config.version=i.version.sky),i.versions&&sky.extra(i.versions,sky.config.versions),i.alias&&sky.extra(i.alias,sky.config.alias);var a=document.location.pathname;t.login=function(t){document.location.replace((/^\/admin\//.test(a)?"/admin/login.html?href=":"/page/login.html?href=")+decodeURIComponent(t||document.location.href))},t.logout=function(){sky.use("ajax",function(e){console.log(e),e.post("/index/Home/Api/logout",function(){this.error||(document.cookie="AGENTID=; path=/",document.cookie="AUTHNAME=; path=/",document.cookie="AUTHIMG=; path=/",t.login())})})};var r;Date.prototype.brevity=function(){var t=(new Date).getTime()-(r||0),e=this.getTime(),n=Math.floor((t-e)/6e4);if(n>2880)return this.format("YYYY-MM-DD");if(n>1440)return"昨天";if(n>60)return Math.floor(n/60)+"小时前";if(0>n){n*=-1;var o=n/60/24,i=24*(o-Math.floor(o)),a=60*(i-Math.floor(i)),c=["还有"];return o>1&&c.push(Math.floor(o)+"天"),i>1&&c.push(Math.floor(i)+"小时"),a>1&&c.push(Math.floor(a)+"分钟"),c.join("")}return n+"分钟前"},t.getServerTime=function(){return new Date((new Date).getTime()-(r||0))},sky.on_connect_ajax=function(e){sky.extra({onsend:function(){t.openLoad()},oncomplete:function(){if(t.closeLoad(),void 0===r&&(r=(new Date).getTime()-new Date(this.getResponseHeader("Date")).getTime()),0==this.status)return!1;var e=this.responseJSON||{};return this.autoLogin&&"80100002"==e.error?(t.login(),!1):void 0},oncensor:function(){var t=this.status,e="未定义错误类型";if(this.resultCode=-1*t,this.resultText="",!this.timeout&&t>=200&&300>t||304===t||1223===t){var n=this.responseJSON;return n?void 0===n.error||"0"==n.error?(this.resultCode=0,!0):this.resultText="错误["+n.error+"]":e}return e+"["+this.status+"]"},onopen:function(t){t.append?t.append("ajax",1):t.ajax=1},autoLogin:!0},e.BaseClass.prototype)},sky.on_dom_dom=function(t){function e(e,n){var o,i="fa fa-circle-o",a=t.query(e).attr("className",i);return a.on("vclick",function(){o!=this&&(o&&(o.className=i),o=this,o.className="fa fa-dot-circle-o",n&&n.call(a,o))}),a.val=function(e){return null==e?o?o.getAttribute("value"):"":void t.emit(a[e],"vclick")},a}function n(e,n,o){var i=0,a={},r="fa fa-square-o",c=t.query(e).attr("className",r).forEach(function(t){this._i=t});return c.on("vclick",function(){var t=this._i;void 0!==a[t]?(i-=1,delete a[t],this.className=r,o&&o.call(c,a,i)):n>i&&(i+=1,a[t]=this.getAttribute("value"),this.className="fa fa-check-square-o",o&&o.call(c,a,i))}),c.val=function(e){return null==e?sky.forEach(a,function(t){return t},[]):void sky.forEach(e,function(e){t.emit(c[e],"vclick")})},c}t.live=function(e,n,o){o||(o="vclick");var i=t(e);t.on(i,o,function(){for(var e=t.getEvent(),o=e.target;o&&o!=i;){var a=o.getAttribute("v-fn")||"",r=o.getAttribute("v-data");if(null!=r){(n[a]||n).call(o,r,e);break}o=o.parentNode}})},t.tabs=function(e,n,o){var i;t.query(e).on("vclick",function(){i!=this&&(i&&(t.removeClass(i,n),t.css(i.getAttribute("-for-c"),"display","none")),i=this,t.addClass(i,n),t.css(i.getAttribute("-for-c"),"display","block"))}).get(o||0).emit("vclick")},t.checkBox=function(t,o,i){return"function"==typeof o&&(i=o,o=1),o&&o>1?n(t,o,i):e(t,i)},t.vclick=function(e,n,o){t.appendEvent(e,"vclick",n,o)}},sky.on_data_template=function(t){t.setFormat("brevity",function(t){return new Date(t).brevity()})},i.getPageJS||(i.getPageJS=function(){return document.location.pathname.replace(/\/+$/,"/index.html").replace(/(\/[^\/]*)$/,"/script$1").replace(/[^.]*$/,"source.js")}),document.attachEvent?document.attachEvent("onreadystatechange",function(){("complete"==document.readyState||"loaded"==document.readyState)&&o()}):document.addEventListener("DOMContentLoaded",o,!1)}(api);