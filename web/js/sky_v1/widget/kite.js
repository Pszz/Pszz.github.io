sky.define("./widget/kite",["./dom/dom"],function(t,i){function e(t){return b["client"+t]||k.body["client"+t]}function s(t){return t="scroll"+t,b[t]||k.body[t]}function n(t){if(T){var i="",e=z.split(",");do i=w.css(t,e.shift());while(e.length&&!/translate\(/.test(i)&&!/matrix\(/.test(i));var s=i.split(/,+/);return/translate\(/.test(i)?[parseInt(s[0].replace(/\D/g,""))||0,parseInt(s[1])||0]:/matrix\(/.test(i)?[parseInt(s[4].replace(/\D/g,""))||0,parseInt(s[5])||0]:[0,0]}return[parseInt(w.css(t,"left"))||0,parseInt(w.css(t,"top"))||0]}function o(t,i,e){var s=!1;if(T){var n;if(null!=i&&null!=e)s=!0,n="translate("+i+"px,"+e+"px)";else if(null!=i)s=!0,n="translateX("+i+"px)";else{if(null==e)return s;s=!0,n="translateY("+e+"px)"}return sky.forEach(z.split(","),function(i){w.css(t,i,n)}),s}return null!=i&&(s=!0,t.style.left=i+"px"),null!=e&&(s=!0,t.style.top=e+"px"),s}function h(t,i,s){var n;return i&&i>0&&1>=i&&(n=w.offset(t,2),i=Math.round(i*(e("Width")-n.width))),s&&s>0&&1>=s&&(n||(n=w.offset(t,2)),s=Math.round(s*(e("Height")-n.height))),{left:i,top:s}}function r(t,i){null==t&&(t=this.posLeft),null==i&&(i=this.posTop);var e,n={};return null!=t&&(e=h(this.$,t,i),t=this.isIE6Fixed||this.isAbsolute&&1>t?s("Left")+e.left:e.left,n.left$=t),null!=i&&(e||(e=h(this.$,t,i)),i=this.isIE6Fixed||this.isAbsolute&&1>i?s("Top")+e.top:e.top,n.top$=i),n}function l(t,i,e){var s=r.call(this,t,i);return o(this.$,s.left$,s.top$)&&e.call(this),this}function a(t){if(!t.dragData&&"none"!=t.$.style.display){var i=w.getEvent().type;clearTimeout(t._handle),t._handle=setTimeout(function(){"scroll"==i?l.call(t,t.posLeft||t.ie6fixedLeft,t.posTop||t.ie6fixedTop):l.call(t)},100)}}function d(t){for(var i,e=this.$$={},s=this.$S={},n=this.$.getElementsByTagName("*"),o=0;o<n.length;o+=1)i=n[o].getAttribute(E),i&&(e[i]=n[o],null==s[i]&&(s[i]=[]),s[i].push(n[o]));t&&(t=e[t]),t&&setTimeout(function(){t.focus()},0)}function u(){if(!this.dragData){var t=w.getEvent(),i=n(this.$);this.dragData={x:t.clientX+(this.isFixed?0:s("Left"))-i[0],y:t.clientY+(this.isFixed?0:s("Top"))-i[1],w:p("Width")-this.$.offsetWidth,h:p("Height")-this.$.offsetHeight,move:sky.bind(c,this),end:sky.bind(f,this)},w.appendEvent(k,"vmove",this.dragData.move,!0),w.appendEvent(k,"vup",this.dragData.end,!0),b.style.WebkitUserSelect="none",this.emit("dragStart",t)}}function c(){var t=this.dragData;if(t){var i,e,n=w.getEvent(),h=this.isFixed?0:s("Top"),r=this.isFixed?0:s("Left");this.dragOver?(e=n.clientY-t.y+h,i=n.clientX-t.x+r):(e=Math.min(Math.max(n.clientY-t.y+h,h),t.h+h),i=Math.min(Math.max(n.clientX-t.x+r,r),t.w+r)),o(this.$,i,e),window.getSelection?window.getSelection().removeAllRanges():k.selection.empty(),this.emit("dragMove",n)}}function f(){this.dragData&&(w.removeEvent(k,"vmove",this.dragData.move,!0),w.removeEvent(k,"vup",this.dragData.end,!0),this.dragData=null,b.style.WebkitUserSelect="",this.emit("dragEnd",w.getEvent()))}function p(t){var i=e(t);return F?i:Math.max(i,s(t))}function y(){this.M||(this.M=w.create("div",{style:"position:"+(F?"fixed":"absolute")+";overflow:hidden;top:0;left:0;display:none;z-index:"+this.Z+";background:"+this.background},null,k.body),this.Z+=1,0==I.length&&w.appendEvent(window,"vresize",g),I.push(this),w.opacity(this.M,this.opacity||0))}function v(){if(this.nums+=1,1==this.nums){var t=p("Width"),i=p("Height");this.M.style.display="block",this.M.style.width=t+"px",this.M.style.height=i+"px",!x&&M&&null!==_.frame&&(x=w.create("iframe",{style:"position:"+(F?"fixed":"absolute")+";overflow:hidden;width:"+t+"px;height:"+i+"px;top:0;left:0;"},null,k.body),w.opacity(x,0))}}function m(){if(this.nums-=1,this.nums<1&&(this.M.style.display="none",x)){for(var t=0,i=!1;t<I.length;t+=1)if(I[t].nums>0){i=!0;break}i||(x.style.display="none")}}function g(){clearTimeout(g.time),g.time=setTimeout(function(){for(var t=0;t<I.length;t+=1)I[t].M.style.display="none";for(var i,e=p("Width"),s=p("Height"),t=0;t<I.length;t+=1)(i=I[t])&&i.nums>0&&(i.M.style.display="block",i.M.style.width=e+"px",i.M.style.height=s+"px");x&&(x.style.width=e+"px",x.style.height=s+"px")},100)}function $(){return this._maskDestroyFn?void 0:(this._maskDestroyFn=sky.bind(function(){this.destroy()},this),w.bind(this.mask.M,"vclick",this._maskDestroyFn),this)}i.version="1.0.0";var x,k=document,b=k.documentElement,w=t(0),E="sky-kite",M=6==sky.IE,T=sky.isTouch,z="transform,-webkit-transform,-moz-transform,-o-transform,-ms-transform",D={setX:function(t){return this.posLeft=t,this},setY:function(t){return this.posTop=t,this},bind:function(t,i){if("string"==typeof t){var e,s;if(this.$S[t])e=t,s="click";else{if(!/_([a-z]+)$/.test(t))return this;if(s=RegExp.$1,e=t.replace(/_[a-z]+$/,""),!this.$S[e])return this}return w.expand.appendEvent.call(this.$S[e],s,sky.bind(i,this)),this}for(var n in t)this.bind(n,t[n]);return this},drag:function(t,i){return void 0!==i&&(this.dragOver=i),w.appendEvent(this.$$[t]||this.$,"vdown",sky.bind(u,this)),this},offset:function(t,i){var e=h(this.$,t||this.posLeft,i||this.posTop);this.ie6fixedLeft=e.left,this.ie6fixedTop=e.top;var s=r.call(this,t,i);return o(this.$,s.left$,s.top$),this},html:function(t,i){return this.$.innerHTML=t,d.call(this,i),this},destroy:function(){this.mask&&m.call(this.mask),this._maskDestroyFn&&w.unbind(this.mask.M,"vclick",this._maskDestroyFn),this.$.parentNode.removeChild(this.$),w.removeEvent(window,"vresize",this.resize._),this.isIE6Fixed&&w.removeEvent(window,"scroll",this.resize._),this.emit("destroy")},focus:function(t){var i=(1*w.css(this.$,"z-index")||0)+1;i<this.parent.Z&&(this.$.style.zIndex=this.parent.Z++);try{this.$$[t].focus()}catch(e){}return this.emit("focus"),this},hide:function(){return"none"==this.$.style.display?this:(this.mask&&m.call(this.mask),this.$.style.display="none",this.emit("hide"),this)},show:function(){return"none"!=this.$.style.display?this:(this.mask&&v.call(this.mask),this.$.style.display="",this.emit("show"),this)}},F=M||!b.clientHeight||"createTouch"in document?!1:!0,I=[],_=sky.extend({create:function(){y.call(this);var t=i.create.apply(this,arguments);return t.mask=this,"none"!=w.css(t.$,"display")&&v.call(this),t}},function(t,e,s){this.nums=0,this.Z=s||i.zIndex,i.zIndex=Math.max(this.Z,i.zIndex)+2e3,this.background=t||"#000",this.opacity=null==e?.2:e,this.option=sky.extra(D,{setMaskDestroy:$})});i.zIndex=1e4,i.getClientWidth=function(){return e("Width")},i.getClientHeight=function(){return e("Height")},i.getScrollWidth=function(){return s("Width")},i.getScrollHeight=function(){return s("Height")},i.create=function(t,i,e){var s=sky.extend(sky.EventEmitter,this.option,{});s.emit("create"),s.$="string"==typeof t?w.create("div",null,t).firstChild:t,T&&(/\d/.test(w.css(s.$,"left"))||w.css(s.$,"left",0),/\d/.test(w.css(s.$,"top"))||w.css(s.$,"top",0)),s.parent=this,s.dragOver=this.dragOver,e=e?w(e)||k.body:k.body,e.appendChild(s.$),s.$.style.zIndex=this.Z++,w.appendEvent(s.$,"vdown",sky.bind(s.focus,s)),d.call(s,i),s.resize=function(t,i,e){var n=h(s.$,t||s.posLeft,i||s.posTop);return this.ie6fixedLeft=n.left,this.ie6fixedTop=n.top,l.call(s,t,i,e),s},s.resize._=sky.bind(a,null,s),w.appendEvent(window,"vresize",s.resize._);var n=w.css(s.$,"position");return"fixed"!=n&&"absolute"!=n&&(n="absolute",w.css(s.$,"position",n)),"absolute"==n?s.isAbsolute=!0:"fixed"==n&&(M?(s.isIE6Fixed=!0,s.$.style.position="absolute",w.appendEvent(window,"scroll",s.resize._)):s.isFixed=!0),s},i.Z=9e3,i.Mask=_,i.option=D});