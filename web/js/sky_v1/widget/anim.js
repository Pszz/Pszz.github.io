sky.define("./widget/anim",["./dom/dom"],function(t,e){function r(t){var e=t.match(/^#?(-?)(\w{1})(-?)(\w{1})(-?)(\w{1})$/);return e&&7==e.length?[parseInt(e[1]+e[2]+e[2],16),parseInt(e[3]+e[4]+e[4],16),parseInt(e[5]+e[6]+e[6],16)]:(e=t.match(/^#?(-?\w{2})(-?\w{2})(-?\w{2})$/),e&&4==e.length?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:(e=t.match(/^rgb\((-?\d{1,3}),\s*(-?\d{1,3}),\s*(-?\d{1,3})\)$/),e&&4==e.length?[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)]:[255,255,255]))}function n(t,r){f.append(t,r),null==s?(l=1,s=setInterval(o,1e3/e.FPS)):l+=1}function a(t,e){return f.has(t)&&(e&&f.get(t)(e),f.remove(t),l-=1),1>l&&(clearInterval(s),s=null),this}function o(){sky.forEach(f.data,function(t,e){f.data[e]()})}function i(t){function r(r){r=r||0;var n=f-y+(new Date).getTime(),o=0!=r||n>=f,c={};return o?((1>r||0!=r&&v)&&sky.forEach(i,function(r,n){c[n]=e.execution[n]?e.execution[n](t,1,r,u[n],s[n]):e.execution.natural(t,n,1,r,u[n],s[n])}),0==r&&a(t),void(1>r&&"function"==typeof d&&d.call(t,c))):(sky.forEach(i,function(r,a){var o=e.rules[m[a]](n,f);c[a]=e.execution[a]?e.execution[a](t,o,r,u[a],s[a]):e.execution.natural(t,a,o,r,u[a],s[a])}),void(p&&p.call(t,c)))}t=c(t),a(t,1);var o=sky.extra(arguments[1],{}),i={},u={},s={},l=0,f=o.speed||1.2,d=o.callback||null,p=o.run,h=e.rules[o.rule]?o.rule:e.rule,v=o.homing!==!1,m={};delete o.speed,delete o.callback,delete o.rule,delete o.homing,delete o.run,sky.forEach(o,function(r,n){n=n.replace(/\-([a-z])/g,function(){return arguments[1].toUpperCase()}).split(/_/);var a=/\$$/.test(n[0]),o=n[1]||"";n=n[0].replace(/\$$/,""),m[n]=e.rules[o]?o:h,l=Math.max(e.initial[n]?e.initial[n](t,r,i,u,s,f,a):e.initial.natural(t,n,r,i,u,s,f,a),l)}),10>f&&(f=Math.max(l,400));var y=(new Date).getTime()+f;return n(t,r),this}e.version="1.0.0",e.FPS=50,e.rule="cos";var c=t("dom"),u=c.css;e.initial={natural:function(t,e,r,n,a,o,i,s,l){var f=u(t,e),d=f.replace(/[\d\-.]|auto/g,"");n[e]=""!=d||"width"!=e&&"height"!=e?parseInt(f)||0:c[e](t);var p=s?r:n[e]+r;return a[e]=(l||p>=0?p:0)-n[e],o[e]=d||"px",i>10?i:Math.abs(a[e]*i)},opacity:function(t,e,r,n,a,o,i){var c="opacity",s=u(t,c);r[c]=parseFloat(s)||0;var l=Math.max(0,Math.min(1,i?e:r[c]+e));return n[c]=l-r[c],a[c]="",o>200?o:Math.abs(n[c]*o*400)}},e.execution={natural:function(t,e,r,n,a,o){var i=Math.max(r*a+n,0)+o;return u(t,e,i),i},opacity:function(t,e,r,n){var a=e*n+r;return u(t,"opacity",a),a}},sky.forEach(["marginLeft","marginRight","marginTop","marginBottom","top","left","bottom","right"],function(t){e.initial[t]=function(r,n,a,o,i,c,u){return e.initial.natural(r,t,n,a,o,i,c,u,!0)},e.execution[t]=function(e,r,n,a,o){var i=r*a+n+o;return u(e,t,r*a+n+o),i}}),e.rules={cos:function(t,e){return-Math.cos(t/e*Math.PI)/2+.5},linear:function(t,e){return t/e},regularEaseIn:function(t,e){return(t/=e)*t},regularEaseOut:function(t,e){return-1*(t/=e)*(t-2)},regularEaseInOut:function(t,e){return(t/=e/2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicEaseIn:function(t,e){return(t/=e)*t*t},cubicEaseOut:function(t,e){return(t=t/e-1)*t*t+1},cubicEaseInOut:function(t,e){return(t/=e/2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartEaseIn:function(t,e){return(t/=e)*t*t*t},quartEaseOut:function(t,e){return-((t=t/e-1)*t*t*t-1)},quartEaseInOut:function(t,e){return(t/=e/2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},strongEaseIn:function(t,e){return(t/=e)*t*t*t*t},strongEaseOut:function(t,e){return(t=t/e-1)*t*t*t*t+1},strongEaseInOut:function(t,e){return(t/=e/2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineEaseIn:function(t,e){return-1*Math.cos(t/e*(Math.PI/2))+1},sineEaseOut:function(t,e){return Math.sin(t/e*(Math.PI/2))},sineEaseInOut:function(t,e){return-.5*(Math.cos(Math.PI*t/e)-1)},expoEaseIn:function(t,e){return 0==t?0:Math.pow(2,10*(t/e-1))},expoEaseOut:function(t,e){return t==e?1:-Math.pow(2,-10*t/e)+1},expoEaseInOut:function(t,e){return 0==t?0:t==e?1:(t/=e/2)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},circEaseIn:function(t,e){return-1*(Math.sqrt(1-(t/=e)*t)-1)},circEaseOut:function(t,e){return 1*Math.sqrt(1-(t=t/e-1)*t)},circEaseInOut:function(t,e){return(t/=e/2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},backEaseIn:function(t,e){return(t/=e)*t*(2.70158*t-1.70158)},backEaseOut:function(t,e){return(t=t/e-1)*t*(2.70158*t+1.70158)+1},backEaseInOut:function(t,e){var r=1.70158;return(t/=e/2)<1?.5*t*t*(((r*=1.525)+1)*t-r):.5*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)},bounceEaseOut:function(t,e){return(t/=e)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceEaseIn:function(t,e){return 1-this.bounceEaseOut(e-t,e)},bounceEaseInOut:function(t,e){return e/2>t?.5*this.bounceEaseIn(2*t,e):.5*this.bounceEaseOut(2*t-e,e)+.5},elasticEaseIn:function(t,e){if(0==t)return 0;if(1==(t/=e))return 1;var r=.3*e,n=r/4;return-(Math.pow(2,10*(t-=1))*Math.sin(2*(t*e-n)*Math.PI/r))},elasticEaseOut:function(t,e){if(0==t)return 0;if(1==(t/=e))return 1;var r=.3*e,n=r/4;return Math.pow(2,-10*t)*Math.sin(2*(t*e-n)*Math.PI/r)+1},elasticEaseInOut:function(t,e){if(0==t)return 0;if(2==(t/=e/2))return 1;var r=.3*e*1.5,n=r/4;return 1>t?-.5*Math.pow(2,10*(t-=1))*Math.sin(2*(t*e-n)*Math.PI/r):Math.pow(2,-10*(t-=1))*Math.sin(2*(t*e-n)*Math.PI/r)*.5+1}},sky.forEach(["backgroundColor","color","borderColor","borderLeftColor","borderRightColor","borderTopColor","borderBottomColor"],function(t){e.execution[t]=function(e,r,n,a){for(var o,i=0,c=[];3>i;i+=1)o=r*a[i]+n[i],c[i]=o>=0?255>=o?Math.round(Math.abs(o)):255:0;return o="rgb("+c.join(",")+")",u(e,t,o),o},e.initial[t]=function(e,n,a,o,i,c,s){a[t]=r(u(e,t)),n=r(n),o[t]=[];for(var l,f=0;3>f;f+=1)l=s?n[f]:a[t][f]+n[f],o[t][f]=(l>=0?255>=l?l:255:0)-a[t][f];return c}});var s,l,f=new c.Cache;e.play=i,e.stop=function(t){return t?(a(c(t),-1),e):(sky.forEach(f.data,function(t,e){f.data[e](-1),f.remove(e),l-=1}),e)}});