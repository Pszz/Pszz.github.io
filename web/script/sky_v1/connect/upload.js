void function(){function e(){var e=["porxy="+this.porxy],t=this.accept;return t&&t.length&&e.push("type=*."+t.join(";*.")),e.join("&")}function t(e){return document[e]||document.getElementById(e)}var r=!window.FormData,n=0;sky.define("./connect/upload",r?null:["./connect/ajax"],function(o,s){function a(e){var t;return n+=1,r?(t="_upload_"+n.toString(36),window[t]={appendSelect:function(t){e._append(t)},progress:function(t,r){e._progress(t,r)},complete:function(t,r){e._complete(t,r)}}):t={onchange:function(){var r=[];n+=1;for(var o,s,a=0;a<this.files.length;a+=1)o="upid"+n+"_"+a,s=t._list[o]=this.files[a],r.push({id:o,name:s.name,size:s.size});e._append(r)},submit:function(r,n,o){var s=new FormData;s.append(o,this._list[r]);var a=t._ajax[r]=c.post(n,function(){delete t._ajax[r],e._complete(r,200!=this.status?null:this.responseText)},s);a.on("progress",function(t){t.lengthComputable&&e._progress(r,Math.ceil(t.loaded/t.total*100))})},cancel:function(e){var r=t._ajax[e];r&&(r.abort(),delete t._ajax[e])},_list:{},_ajax:{}},t}var c=r?null:o("./connect/ajax"),i="_swf_embed_",u=s.BaseClass=sky.extend(sky.EventEmitter,{create:function(t){var n=document.getElementById(t);this.conId=t;var o=this.embedId=t+i;if(r){var s=e.call(this),a=this.swfUrl||sky.config.base+"connect/upload.swf";n.innerHTML=sky.IE?['<object class="_swf_up_" width="100%" height="100%" id="'+o+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">','<param value="'+a+'" name="movie">','<param value="high" name="quality">','<param value="transparent" name="wmode">','<param name="allowFullscreen" value="false">','<param name="allowScriptAccess" value="always">','<param name="FlashVars" value="'+s+'" />',"</object>"].join(""):'<embed class="_swf_up_" name="'+o+'" FlashVars="'+s+'" src="'+a+'" width="100%" height="100%" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" wmode="transparent"></embed>'}else this.clear()},clear:function(){if(!r){var e=document.getElementById(this.conId),t=this.embedId;e.innerHTML='<input id="'+t+'" class="_file_up_" type="file" multiple="true" accept="'+this.inputAccept+'" />',document.getElementById(t).onchange=this.porxy.onchange}return this},getEmbed:function(){return r?document[this.embedId]||document.getElementById(this.embedId):this.porxy},submit:function(e){var n=this.getList(e);n&&!n.complete&&(null==n.url&&(n.url=this.url),(r?t(this.embedId):this.porxy).submit(n.id,this.url,this.name),this.emit("submit",e))},cancel:function(e){var n=this.getList(e);n&&(this.emit("cancel",e),delete this.list[e],n.url&&(r?t(this.embedId):this.porxy).cancel(n.id))},getList:function(e){var t=this.list;return null==e?t:t[e]},_append:function(e){var t=this.list,r=" "+this.accept.join(" ")+" ";this.emit("select",sky.forEach(e,function(e){var n=e.name.split(".").pop();return e.valid=r.indexOf(" "+n+" ")>-1,t[e.id]=e,e.id},[]))},_complete:function(e,t){var r=this.getList(e);r&&(r.complete=!0,this.emit("complete",e,t))},_progress:function(e,t){var r=this.getList(e);r&&this.emit("progress",e,t)}},function(e,t){this.url=e,this.name=t||"file",this.list={},this.accept=[],this.porxy=a(this)});s.create=function(e,t){return new u(e,t)}})}();