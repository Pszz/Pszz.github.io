sky.define("./data/template",function(t,r){r.version="1.0.0";var e=/<!--\s*\^\s*(\w+)\s*-->(.*)<!--\s*\1\s*\$\s*-->/g;var n=/\{([#]?)(.*?)(?:\|([\w\$]+)(?:\((.*?)\))?)?\}/g;function a(t,r){if(r=="*"){return t}var e=r.split(/[.]+/);while(t!=null&&e.length){t=t[e.shift()]}return t}function i(t,r){if(t==null){t=""}t=String(t).replace(/\"/g,"&#34;").replace(/\'/g,"&#39;");if(r){t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return t}var l=r.format={apply:function(t,r){return this.apply(r,t)},applyArray:function(t,r,e){return this.applyArray(r,t).join(e||"")},htmlEncode:function(t){return i(t,true)},htmlEncodeBr:function(t){return i(t,true).replace(/\n/g,"<br />")},valueEncode:function(t){return i(t)}};r.setFormat=function(){var t=Array.prototype.slice.call(arguments);t.push(this.format);sky.extra.apply(this,t);return this};var s=r.BaseClass=sky.extend({getLocal:function(t){var r=document.getElementsByTagName("script"),e,n=0;if(t==null){t="text/html"}for(;n<r.length;n+=1){if((e=r[n]).getAttribute("type")==t){this.setModel(e.innerHTML);e.parentNode.removeChild(e)}}return this},setModel:function(t,r){if(r){this.data[r]=t}else{var n=t.replace(/^\s+|\s+$|\n+|\r+/g,"").replace(/>\s+</g,"><"),a;while(a=e.exec(n)){this.data[a[1]]=a[2]}}return this},apply:function(t,r){if(this.data[t]){var e=this,i=e.format;var s=arguments;return e.data[t].replace(n,function(t,n,u,o,c){var f;var p=n=="#"?r:s;var h=i[o]||l[o];if(typeof h=="function"){var y=u?sky.forEach(u.split(","),function(t){return a(p,t)},[]):[];f=h.apply(e,y.concat((c||"").split(/,/)))}else if(u){f=a(p,u)}if(f==null){f=""}return f})}return""},applyArray:function(t,r){return r?sky.forEach(r,function(r,e){return this.apply(t,r,e)},[],this):[]},call:function(){var t=Array.prototype.slice.call(arguments),r=t.shift();return this.format[r].apply(this,t)},setFormat:r.setFormat},function(){this.data={};this.format=sky.extra(l,{})});r.create=function(t){var r=new s;if(t){r.getLocal(t)}return r}});